# üîß –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã SSH –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

## ‚ùå –û—à–∏–±–∫–∞
```
ssh: handshake failed: ssh: unable to authenticate, attempted methods [none publickey]
```

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### –®–∞–≥ 1: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ SSH –∫–ª—é—á–∞

–ù–∞ –≤–∞—à–µ–π **–ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ** –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```bash
# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è SSH –∫–ª—é—á–∞ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ –¥–ª—è GitHub Actions
ssh-keygen -t ed25519 -C "github-actions-ononimka" -f ~/.ssh/ononimka_deploy -N ""

# –≠—Ç–æ —Å–æ–∑–¥–∞—Å—Ç –¥–≤–∞ —Ñ–∞–π–ª–∞:
# ~/.ssh/ononimka_deploy      - –ü–†–ò–í–ê–¢–ù–´–ô –∫–ª—é—á (–¥–ª—è GitHub Secret)
# ~/.ssh/ononimka_deploy.pub  - –ü—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á (–¥–ª—è VPS)
```

### –®–∞–≥ 2: –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—É–±–ª–∏—á–Ω–æ–≥–æ –∫–ª—é—á–∞ –Ω–∞ VPS

```bash
# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –Ω–∞ VPS
ssh-copy-id -i ~/.ssh/ononimka_deploy.pub your_username@your_vps_ip

# –ò–ª–∏ –≤—Ä—É—á–Ω—É—é:
cat ~/.ssh/ononimka_deploy.pub
# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤—ã–≤–æ–¥ –∏ –¥–æ–±–∞–≤—å—Ç–µ –≤ VPS –≤ —Ñ–∞–π–ª ~/.ssh/authorized_keys
```

### –®–∞–≥ 3: –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –∫–ª—é—á —Ä–∞–±–æ—Ç–∞–µ—Ç
ssh -i ~/.ssh/ononimka_deploy your_username@your_vps_ip

# –ï—Å–ª–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ, –ø—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ
```

### –®–∞–≥ 4: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ GitHub Secret

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ GitHub: `Repository ‚Üí Settings ‚Üí Secrets and variables ‚Üí Actions`

2. –ù–∞–π–¥–∏—Ç–µ —Å–µ–∫—Ä–µ—Ç `VPS_SSH_KEY` –∏ –Ω–∞–∂–º–∏—Ç–µ **Update**

3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ **–ü–†–ò–í–ê–¢–ù–´–ô** –∫–ª—é—á:
   ```bash
   cat ~/.ssh/ononimka_deploy
   ```

4. –í—Å—Ç–∞–≤—å—Ç–µ **–í–ï–°–¨** –≤—ã–≤–æ–¥ –≤ —Å–µ–∫—Ä–µ—Ç, –≤–∫–ª—é—á–∞—è —Å—Ç—Ä–æ–∫–∏:
   ```
   -----BEGIN OPENSSH PRIVATE KEY-----
   ...—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫–ª—é—á–∞...
   -----END OPENSSH PRIVATE KEY-----
   ```

### –®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥—Ä—É–≥–∏—Ö —Å–µ–∫—Ä–µ—Ç–æ–≤

–£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤—Å–µ —Å–µ–∫—Ä–µ—Ç—ã –∑–∞–ø–æ–ª–Ω–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ:

```bash
# –ù–∞ VPS –ø—Ä–æ–≤–µ—Ä—å—Ç–µ username
whoami

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ IP
curl ifconfig.me

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ SSH –ø–æ—Ä—Ç (–æ–±—ã—á–Ω–æ 22)
sudo netstat -tlnp | grep ssh
```

–û–±–Ω–æ–≤–∏—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã –≤ GitHub:
- `VPS_HOST` - –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å IP –∞–¥—Ä–µ—Å (–Ω–∞–ø—Ä–∏–º–µ—Ä: `123.45.67.89`)
- `VPS_USERNAME` - –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç `whoami` (–Ω–∞–ø—Ä–∏–º–µ—Ä: `ubuntu`, `root`)
- `VPS_PORT` - –æ–±—ã—á–Ω–æ `22`

### –®–∞–≥ 6: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –Ω–∞ VPS

–ù–∞ VPS –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –Ω–∞ .ssh –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
chmod 700 ~/.ssh
chmod 600 ~/.ssh/authorized_keys

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ authorized_keys
cat ~/.ssh/authorized_keys
# –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á, –∫–æ—Ç–æ—Ä—ã–π –≤—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞–ª–∏
```

### –®–∞–≥ 7: –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –º–µ—Ç–æ–¥ (RSA –∫–ª—é—á)

–ï—Å–ª–∏ ed25519 –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ RSA:

```bash
# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è RSA –∫–ª—é—á–∞
ssh-keygen -t rsa -b 4096 -C "github-actions-ononimka" -f ~/.ssh/ononimka_deploy_rsa -N ""

# –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ VPS
ssh-copy-id -i ~/.ssh/ononimka_deploy_rsa.pub your_username@your_vps_ip

# –¢–µ—Å—Ç
ssh -i ~/.ssh/ononimka_deploy_rsa your_username@your_vps_ip

# –ü–æ–ª—É—á–∏—Ç—å –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è GitHub Secret
cat ~/.ssh/ononimka_deploy_rsa
```

### –®–∞–≥ 8: –ü—Ä–æ–≤–µ—Ä–∫–∞ SSH –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –Ω–∞ VPS

–ù–∞ VPS –ø—Ä–æ–≤–µ—Ä—å—Ç–µ `/etc/ssh/sshd_config`:

```bash
sudo nano /etc/ssh/sshd_config
```

–£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤–∫–ª—é—á–µ–Ω–æ:
```
PubkeyAuthentication yes
AuthorizedKeysFile .ssh/authorized_keys
```

–ï—Å–ª–∏ –∏–∑–º–µ–Ω–∏–ª–∏, –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ SSH:
```bash
sudo systemctl restart ssh
```

### –®–∞–≥ 9: Debug —Ä–µ–∂–∏–º

–ï—Å–ª–∏ –≤—Å–µ –µ—â–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ SSH –≤ debug —Ä–µ–∂–∏–º–µ –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ:

```bash
ssh -vvv -i ~/.ssh/ononimka_deploy your_username@your_vps_ip
```

–≠—Ç–æ –ø–æ–∫–∞–∂–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø—Ä–æ—Ü–µ—Å—Å–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è.

---

## üéØ –ë—ã—Å—Ç—Ä—ã–π —á–µ–∫–ª–∏—Å—Ç

- [ ] –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω SSH –∫–ª—é—á (ed25519 –∏–ª–∏ RSA)
- [ ] –ü—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –Ω–∞ VPS
- [ ] –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ (`ssh -i ~/.ssh/ononimka_deploy user@ip`)
- [ ] **–ü–†–ò–í–ê–¢–ù–´–ô** –∫–ª—é—á (–Ω–µ –ø—É–±–ª–∏—á–Ω—ã–π!) –¥–æ–±–∞–≤–ª–µ–Ω –≤ GitHub Secret `VPS_SSH_KEY`
- [ ] –í—Å–µ —Å—Ç—Ä–æ–∫–∏ –∫–ª—é—á–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã (–≤–∫–ª—é—á–∞—è `-----BEGIN` –∏ `-----END`)
- [ ] `VPS_HOST` —Å–æ–¥–µ—Ä–∂–∏—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π IP
- [ ] `VPS_USERNAME` —Å–æ–¥–µ—Ä–∂–∏—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- [ ] `VPS_PORT` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ `22` (–∏–ª–∏ –≤–∞—à SSH –ø–æ—Ä—Ç)
- [ ] –ü—Ä–∞–≤–∞ –Ω–∞ VPS: `~/.ssh` = 700, `~/.ssh/authorized_keys` = 600
- [ ] `PubkeyAuthentication yes` –≤ `/etc/ssh/sshd_config`

---

## üîç –ß–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏

### ‚ùå –û—à–∏–±–∫–∞: –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –≤–º–µ—Å—Ç–æ –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ

**–ü—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á** (–ù–ï–ü–†–ê–í–ò–õ–¨–ù–û –¥–ª—è VPS_SSH_KEY):
```
ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIxxxxxx github-actions
```

**–ü—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á** (–ü–†–ê–í–ò–õ–¨–ù–û –¥–ª—è VPS_SSH_KEY):
```
-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAAAMwAAAAtzc2gtZW
...–º–Ω–æ–≥–æ —Å—Ç—Ä–æ–∫...
-----END OPENSSH PRIVATE KEY-----
```

### ‚ùå –û—à–∏–±–∫–∞: –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ —Ç–æ–ª—å–∫–æ —á–∞—Å—Ç—å –∫–ª—é—á–∞

–ù—É–∂–Ω–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å **–í–°–ï —Å—Ç—Ä–æ–∫–∏**, –≤–∫–ª—é—á–∞—è –ø–µ—Ä–≤—É—é –∏ –ø–æ—Å–ª–µ–¥–Ω—é—é!

### ‚ùå –û—à–∏–±–∫–∞: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –≤ GitHub Secret

–ü—Ä–∏ –≤—Å—Ç–∞–≤–∫–µ –≤ GitHub Secret —É–±–µ–¥–∏—Ç–µ—Å—å:
- –ù–µ—Ç –ª–∏—à–Ω–∏—Ö –ø—Ä–æ–±–µ–ª–æ–≤ –≤ –Ω–∞—á–∞–ª–µ/–∫–æ–Ω—Ü–µ
- –í—Å–µ —Å—Ç—Ä–æ–∫–∏ –Ω–∞ –º–µ—Å—Ç–µ
- –ö–ª—é—á –≤—Å—Ç–∞–≤–ª–µ–Ω –∫–∞–∫ –æ–±—ã—á–Ω—ã–π —Ç–µ–∫—Å—Ç (–Ω–µ base64)

---

## üìû –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

–ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è `VPS_SSH_KEY`:

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Actions** –≤ GitHub
2. –ù–∞–∂–º–∏—Ç–µ **Re-run failed jobs** –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–º failed workflow
3. –ò–ª–∏ —Å–¥–µ–ª–∞–π—Ç–µ –Ω–æ–≤—ã–π commit:
   ```bash
   git commit --allow-empty -m "Test SSH fix"
   git push origin main
   ```

–î–µ–ø–ª–æ–π –¥–æ–ª–∂–µ–Ω –ø—Ä–æ–π—Ç–∏ —É—Å–ø–µ—à–Ω–æ! ‚úÖ
